---
title: "Global Life Expectancy: Unraveling Health and Economic Determinants (2015-2020)"
subtitle: "Multiple Linear Regression Analyzing Critical Factors Shaping Life Expectancy "
author: 
  - Yanfei Huang
thanks: "Code and data are available at: [https://github.com/wendyhuan/lifeexpectancy](https://github.com/wendyhuan/lifeexpectancy)."
date: 02 December 2024
date-format: long
abstract: "This paper analyze life expectancy and its determinants through 184 countries and make the prediction of people from different Income Group. Multiple Linear regression is used to deploying the life expectanc with gender, income and region. Predictions of life expectancy of people from different income group is made according to these essential predictors. The finding indicates that the life expectancy is tend to get higher as the economic class grows. And we predict that the average age of person from low, lower-middle, upper-middle and high are 62.35, 68.40, 73.38, 79.38. The result of this paper will help in suggesting a country which area should be given importance in order to efficiently improve the life expectancy of its population."
format: pdf
toc: true
toc-depth: 3
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

# Install Packages if not downloaded:
required_packages <- c(
  "tidyverse", "sf", "dplyr", "here", "arrow", "ggplot2", "janitor", "purrr", "knitr", "kableExtra", "ggcorrplot", "modelsummary", "countrycode", "gridExtra"
)
for (p in required_packages) {
  if (!require(p, character.only = TRUE)) {
    install.packages(p, character.only = TRUE)
  }
}


#load libraries
library(tidyverse)
library(sf)
library(dplyr)
library(here)
library(arrow)
library(ggplot2)
library(janitor)
library(purrr)
library(knitr)
library(kableExtra)
library(xtable)
library(ggcorrplot)
library(modelsummary)
library(countrycode)
library(gridExtra)
library(caret)
library(tinytex)


# load data
lelecleaned_data <- read_parquet("~/lifeexpectancy/data/02-analysis_data/lelecleaned.parquet")
lea60 <- read_parquet("~/lifeexpectancy/data/02-analysis_data/lea60.parquet")
leab <- read_parquet("~/lifeexpectancy/data/02-analysis_data/leab.parquet")
male_table <- read_parquet("~/lifeexpectancy/data/02-analysis_data/male_table.parquet")
female_table <- read_parquet("~/lifeexpectancy/data/02-analysis_data/female_table.parquet")
average_life_expectancy <- read_parquet("~/lifeexpectancy/data/02-analysis_data/average_life_expectancy.parquet")
sum_sta <- read_parquet("~/lifeexpectancy/data/02-analysis_data/sum_sta.parquet")
matable <- read_parquet("~/lifeexpectancy/data/02-analysis_data/matable.parquet")
femaletable <- read_parquet("~/lifeexpectancy/data/02-analysis_data/femaletable.parquet")
model_developed <- readRDS(file = "~/lifeexpectancy/models/ledata_normal_model.rds")
bothg_average_life_expectancy <- read_parquet("~/lifeexpectancy/data/02-analysis_data/bothg_average_life_expectancy.parquet")
```

# Introduction

Life expectancy is a critical measure of a population's overall health and well-being, shaped by various factors such as gender, geographic location and economic group. The index of life expectancy is generally served as a benchmark for income group, indicating the effectiveness of interventions in reducing mortality and improving well-being. Higher life expectancy is believed to linked to stronger physical factor, better living standards, and geographic location. Conversely, low life expectancy often signals systemic challenges such as weaker health, lower economic situation, and inadequate healthcare access of different region. [@socialdeterminantsofhealth].

The primary goal of this paper is to determine which factors play a statistically significant role in driving lower life expectancy values and to offer actionable insights based on different income group. According to the World Bank Income Group, the countries are classified into low, lower-middle, upper-middle, and high based on the country's Gross National Income. Using Multiple Linear Regression model and Bayesian model, this study focuses on understanding the relationship between Gender, Region and different income group in predicting life expectancy across different countries. By identifying and analyzing these predictors, the study aims to highlight actionable aspects for policymakers to target in their efforts to improve population longevity effectively.

Related Research has shown that there exist difference between men and women related with biological, behavioral, and socioeconomic factors, highlighting that gender-specific health behaviors and societal roles influence longevity [@GenderandLifeExpectancy]. Higher-income individuals tend to live longer due to better access to healthcare and healthier lifestyles, with notable regional disparities even within similar income groups [@IncomeGroupsandLongevity]. Additionally, regional socioeconomic differences on health outcomes, especially life expectancy. It emphasizes that addressing regional inequities in wealth and resources is essential for improving population health globally. [@RegionalVariations].

Findings from this paper reveal that countries of higher income group tend to achieve higher life expectancy, while factors like lower income and poverty region emerge as significant obstacles. The analysis underscores the importance of targeted interventions in key areas such as healthcare accessibility and economic equity to address disparities in life expectancy. This study further contributes to a deeper understanding of how predictive modeling under different country status can inform public health strategies and policy-making on a global scale.

The ultimate goal is to assist policymakers in developing evidence-based strategies that can enhance population health outcomes. The approach of this paper not only emphasizes the importance of equitable access to healthcare but also contributes to a broader understanding of the multifaceted factors shaping life expectancy globally. By highlighting the interplay between various determinants, this study contributes to a broader understanding of the challenges and opportunities in improving life expectancy on a global scale.

The structure of the paper is as follows: [@sec-data] outlines the data sources and variables considered, followed by the model setup in [@sec-modset] and justification in [@sec-modjust]. The results in [@sec-result] presents the key findings of the analysis, with a discussion on the implications. [@sec-discussion] then discusses potential limitations and suggestions for future research. [@sec-appx] provides additional detailed information about the data, model and methodology.

# Data {#sec-data}

## Overview

The data used in this analysis originates from The World Health Organization’s (WHO) and Global Health Observatory (GHO) [@lifeexpectancy]. This data-set related to life expectancy, health factors for 184 countries has been collected from WHO data repository website and its corresponding economic data was collected from United Nation website. Among all categories of health-related factors only those socio-economic factors on the national level were chosen for global scale analysis.

This analysis uses the statistical programming language R [@citeR] and several libraries, including `tidyverse` [@tidyverse], `janitor` [@janitor], `knitr` [@knitr], `dplyr` [@dplyr], `arrow` [@arrow], `purrr` [@purrr], `sf` [@sf], and `here` [@here] for data manipulation. `ggplot2` [@ggplot2], `ggcorrplot` [@ggcorrplot] and `kableExtra` [@kableExtra] for visualization. The dataset covers various predictors conducted across multiple countries, capturing the support for a country to determine the predicting factor which is contributing to lower value of life expectancy.

## Measurement

The measurement process refers to how real-world factors—such as the Gender, geographic location of a country and income group - are translated into numerical entries representing life expectancy in a dataset. Each entry captures the average life expectancy of individuals in a specific country during a given year.

**Life Expectancy (`Life Expectancy`)**: This variable, life expectancy at birth, represents the number of years a person is expected to live , assuming current mortality conditions persist. It is derived using data from national health records, the World Health Organization (WHO) and Global Health Observatory (GHO). The data on the raw dataset is recorded as a range of age. For simple analysis, we drop the range and take the average of year with one decimal. The values are calculated and represented in age between 10.1 to 87.4.

**Income Group(`Income_Group`)**: This is a categorical variable that classifies countries into four groups by the country's Gross National Income according to the latest index from World Bank Income Group. The countries are classified into low, lower-middle, upper-middle, and high under the standard as follow. Low-income economies is defined as a country with a gross national income less than \$1135, lower-middle is between the range to \$1136 to \$4465, upper-middle in the range of \$4465 to \$13845 and high is more than \$13846.

**Gender(`Gender`)**: The gender of the population of each country is included as a categorical variable (Male/Female/Both Sex).

**Region(`Region`)**: This is a categorical variable that classifies the geographic location of the countries. It is mapped one by one by the name of the country. The data is stored as the name of the continent(‘Africa’, ‘Oceania’, ‘Asia’, ‘Europe’, ‘North America’, ‘South America’).

## Data Cleaning

The raw life expectancy data underwent a several cleaning steps to ensure it was accurate, consistent and ready for analysis. The goal of this cleaning process is to create a table including income group (high, upper middle, lower middle, low), gender (Male, Female, Both Sex), region (Asia, Europe, North America, South America, Africa, Oceania) as rows and life expectancy as column.

To make such table, we first select and rename key variables from raw data to focus on relevant information. To make the subsequent analysis easier, we then convert variables to the proper data types and eliminate the rows that have missing data values. To keep things neat, we organize the decimal for every piece of numerical data and drop the percentage symbol. The income group column and the region column was not given in the raw dataset. We created a mapping over country name to four income group according to the index given by World Bank Income Group and save the data under "Income_Group". We as well made a mapping to the countries according to its continent and saved as "Region". We again merge the table, removing repeated columns and rows. For easier visualization, we created four tables, which are grouped by life expectancy at age 60, life expectancy at birth, life expectancy at birth of Male and life expectancy at birth of Female. For easier summary and convenience for graph drawing, we calculate the average of life expectancy of each country under 6 years. Also, we calculate the average of 6 years life expectancy according to the other 4 income groups and different gender by mutate according to the different factors. We then merge the columns of each table into a summary table for easy looking.

@tbl-sum_sta shows the average of life expectancy under male, female, 6 different regions and 4 income groups. Life expectancy according to different countries have attached and be found in data cleaning full data in @sec-appx.

The cleaned dataset was then saved as both CSV and Parquet file for efficient storage and further analysis.

More information on the data cleaning process can be found in @sec-appx.

```{r}
#| label: tbl-sum_sta
#| tbl-cap: "This table shows the cleaned data of life expectancy at different predictor. We could visual that high income has the highest life expectancy of 79.8, compared to lower income has the least life expectancy of 62.35. Among all the region, it's clear that Africa has the least 64.17, while Europe has the highest 78.50 years old. Female has slightly higher life expectancy than male. "
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Format and style the sum_sta table using kableExtra
sum_sta %>%
  kable(
    col.names = c("Region/Income/Gender", "Life Expectancy"),  # Column names
    align = c("l", "c"),                                       # Left-align column 1, center-align column 2
    digits = 2 ) %>%
  kable_styling(          # Add striped rows and prevent table floating
    full_width = FALSE,                                        # Prevent table from stretching to full width
    font_size = 10                                             # Adjust font size
  ) 
  
```

## Outcome Variables

The outcome variable is **Life Expectancy**. This is the primary dependent variable that the model is designed to predict. It represents the average number of years a person is expected to live, under the condition that current mortality conditions persist. The model seeks to identify the variables affecting this average.

@fig-expectancy visualizes the distribution of life expectancy from 2015 to 2020 as percentages. The histogram visualizes the distribution of life expectancy grouped into 5-year ranges, expressed as percentages. Most of the data lies between the ranges of 66–81 years, with the largest percentage (24.7%) in the 76–81 range. This suggests that a significant portion of individuals have life expectancy within this range. The data also shows smaller percentages at the lower (46–56 years) and higher ends (81–86 years). Additionally, a small percentage of missing (NA) values may highlight areas for data quality. Even we remove the NA while cleaning, the data of NA still exists for not belongs to any of these ranges.

```{r}
#| label: fig-expectancy
#| fig-cap: "This histogram shows the distribution of the percentage of life expectancy for all years. Among all the life expectancy ranges, 76-81 has the largest percenage of 24.7%, while the 46-51 has the 0.54%. Life expectancy shows a growing trend with the increasing of age and drop sharply comes to the 81-86 range.    "
#| echo: false
#| eval: true
#| warning: false
#| message: false

# leab is the data frame containing life expectancy of life expectancy at birth of all 3312 data
# Bin Life Expectancy into 5-year ranges
life_expectancy_bins <- leab %>%
  
  mutate(AgeRange = cut(`Life Expectancy`, 
                        breaks = seq(floor(min(`Life Expectancy`, na.rm = TRUE)), 
                                     ceiling(max(`Life Expectancy`, na.rm = TRUE)), 
                                     by = 5), 
                        include.lowest = TRUE)) %>%
  # Calculate the percentage in each age range
  group_by(AgeRange) %>%
  summarise(Count = n()) %>%
  mutate(Percentage = 100 * Count / sum(Count))

# Plot the percentage distribution
ggplot(life_expectancy_bins, aes(x = AgeRange, y = Percentage, fill = AgeRange)) +
  geom_bar(stat = "identity", color = "white", alpha = 0.8) +
  geom_text(aes(label = paste0(round(Percentage, 2), "%")), vjust = -0.5, size = 3.5) +
  labs(
    title = "Distribution of Life Expectancy by Age Range",
    x = "Life Expectancy (5-Year Ranges)",
    y = "Percentage"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )

```

## Predictor Variables

The **predictor variables** (or independent variables) are the factors believed to influence the life expectancy:

1.  **Income Group(`Income_Group`)**: The income group of a country is the key factor influencing the life expectancy. This variable provides context for comparing life expectancy between different levels of country income group. The division of the life expectancy by the income group of a country because income levels often correlate strongly with various factors affecting health and longevity. Higher income countries typically have more resources to invest in robust healthcare systems, with better living conditions while lower income countries often face challenges such as inadequate healthcare infrastructure and malnutrition. Following by the four income group, we would like to see the distribution of the income group of 184 WHO member countries. @fig-income shows that there are 55 countries at the high income group, 26 countries at low income group, 54 countries at the lower-middle group while there are 49 countries at the upper-middle group. With significant less low income countries, we expect to see the life expectancy lie in a comparably higher range. On the other hand, there might exist sever outliers dropping the mean.

2.  **Gender(`Gender`)**: The gender of the population of each country is included as a categorical variable (Male/Female/Both Sex). This is a key variable in the dataset because gender has been fully recognized connected with the biological physical factor which directly effect the life expectancy. @fig-gender shows that the with an stable average of 74, life expectancy of female is constantly higher than male's average of 70. The line plot reveals a steady increase until 2019, followed by a sharp decline in 2020, which is assumed to be associated with the impact of COVID-19.

3.  **Region(Region)**: This is a categorical variable that classifies the geographic location of the countries. It is mapped one by one by the name of the country. The data is stored as the name of the continent(‘Africa’, ‘Oceania’, ‘Asia’, ‘Europe’, ‘North America’, ‘South America’). @fig-region indicates that with the number of 54, Africa has the most WHO member countries. Both Asia and Europe has 43 countries,listing in the middle while the other three continent has the significant less number of countries. North America has 22 countries, South America has 12 countries and Oceania has the least, 10 countries.

```{r}
#| label: fig-income
#| fig-cap: "Distribution of country income group. Among 184 WHO member countries, there are 55 high income countries, 54 lower middle income countries and 49 upper middle income countries. There are significant less lower income countries, which we could assume there might exist less outliers in life experctanncy."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Count the number of unique countries for each Status
country_counts <- lelecleaned_data %>%
  # Ensure each country is only counted once
  distinct(Country, Income_Group) %>%  
   # Count the number of countries in each Status category
  count(Income_Group)  

# Create a bar plot to show the distribution of countries by Status
ggplot(country_counts, aes(x = Income_Group, y = n, fill = Income_Group)) +
   # Use 'identity' to directly use the count values
  geom_bar(stat = "identity") + 
   # Add count labels on top of bars
  geom_text(aes(label = n), vjust = -0.5,size = 2.5) +  
  labs(
    title = "Distribution of Country by Income Group",
    x = "Income Group",
    y = "Number of Countries"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("lower_income" = "skyblue", "lower_middle" = "darkblue", "upper_middle" = "blue", "high_income" = "lightblue")) +
  theme(
    legend.position = "none", 
  plot.title = element_text(size = 15,face = "bold"))

```

```{r}
#| label: fig-region
#| fig-cap: "Distribution of different region of the 184 countries. Africa has the most countries with an number of 54. Asia and Europe has the same amount of 43, North America has 22 countries while the other two continent has almost the same amount of countries."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Group by Region and count the number of countries
region_counts <- lelecleaned_data %>%
  distinct(Country, Region) %>%  # Ensure each country is only counted once
  count(Region)  # Count the number of distinct countries in each Region

# Plot: Distribution of countries in different regions
ggplot(region_counts, aes(x = Region, y = n, fill = Region)) +
  geom_bar(stat = "identity") +  # Plot the count of countries
  geom_text(aes(label = n), vjust = -0.3, size = 3) +  # Add count labels on top of bars
  labs(
    title = "Distribution of Countries by Region",
    x = "Region",
    y = "Number of Countries"
  ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3") +  # Color palette for different regions
  theme(
    legend.position = "none",
    plot.title = element_text(size = 10, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate axis labels for clarity
  )

```

```{r}
#| label: fig-gender
#| fig-cap: "Distribution of gender each year. The average of female life expectancy is approximately 74 around years, constantly higher than male's average of 70. Compared to male, female's life expectancy is marginally more steady."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Calculate the average life expectancy per year for males
male_avg <- matable %>%
  group_by(Period) %>%
  summarise(AverageLifeExpectancy = mean(`Life Expectancy`, na.rm = TRUE)) 

# Calculate the average life expectancy per year for females
female_avg <- femaletable %>%
  group_by(Period) %>%
  summarise(AverageLifeExpectancy = mean(`Life Expectancy`, na.rm = TRUE))

#Combine the two tables into one
combined_avg <- bind_rows(male_avg %>% mutate(Gender = "Male"), 
                          female_avg %>% mutate(Gender = "Female"))

# Plot the combined data
ggplot(combined_avg, aes(x = Period, y = AverageLifeExpectancy, color = Gender, group = Gender)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "Life Expectancy Over Years by Gender",
    x = "Period",
    y = "Life Expectancy",
    color = "Gender"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
    legend.position = "top",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

## Basic Data Summary

The table below shows the basic summary of the mean, median, max, standard deviation, variance and sample size of life expectancy. We could tell that the average of the life expectancy from the 6 years is 72.2, with a relatively small standard deviation of 7.8. The max of the life expectancy is 87.4, among all 3312 rows of data. The variance is high because of the range of data is large, in other words, because the mean and median are 72.2 and 73.1, compared to the max 87.4, there is likely some outliers in the data creating such a slightly high variance of 60.1.

```{r}
#| label: fig-summary
#| fig-cap: "Summary statistics of the number of life expectancy over countries and years. Less difference between mean and median, showing that the life expectancy distribution might shows a naturally bell curve.However, variance is slightly high indicates that the tails on both sides might be long. "
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Calculate summary statistics
life_expectancy_stats <- leab %>%
  summarise(
    Mean = round(mean(`Life Expectancy`, na.rm = TRUE), 1),
    Median = median(`Life Expectancy`, na.rm = TRUE),
    Max = max(`Life Expectancy`, na.rm = TRUE),
    SD = round(sd(`Life Expectancy`, na.rm = TRUE), 1),
    Variance = round(var(`Life Expectancy`, na.rm = TRUE), 1),
    N = sum(!is.na(`Life Expectancy`)) # Count of non-missing values
  )

#Create and format the table using kableExtra
life_expectancy_stats %>%
  kable(
    col.names = c("Mean", "Median", "Max", "Standard Deviation", "Variance", "N"),
    align = "c",
    digits = 2 # Ensure numeric values are rounded to 2 decimal places
  ) %>%
  kable_styling(
    full_width = FALSE, 
    font_size = 14
  ) 

```

# Model

## Model set-up {#sec-modset}

The goal of the Bayesian model is to incorporate prior knowledge, such as insights from previous studies or analyses, into the selection of the model. To predict the outcome of the life expectancy of people from different regions, in this paper, we developed a linear regression models using R [@citeR]. The outcome variable, **`Life Expectancy`**, is a continuous and represents the average number of years a person is expected to live, assuming all related resources remain constant throughout their lifetime. The model aim to estimate and predict the life expectancy of people under different gender, region and income group. The normal Gaussian distribution is effective when used for modeling scenarios where the residuals of the data are assumed to be independent nd normally distributed around the regression line. The GAM allows for capturing potential non-linear relationships between the predictors and the outcome.

The model is specified as follows:

```{=tex}

\begin{align*} 
y_i|\mu_i, \sigma &\sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_1 \text{Region}_i + \beta_2 \text{Gender}_i + \beta_3 \text{Income\_Group}_i \\
\alpha &\sim \text{Normal}(0, 2.5) \\
\beta_1, \beta_2, \beta_3 &\sim \text{Normal}(0, 2.5) \\
\sigma &\sim \text{Exponential}
\end{align*}

```
Where:

-   $yi$ is the outcome variable (Life Expectancy)for the i-th observation.

-   $\mu_i$: the linear predictor for life expectancy, including the intercept ($\alpha$) and the coefficients for the predictors Region, Country, Income Group, and Gender.

-   Priors for the intercept($\alpha$) and the coefficients($\beta_1, \beta_2, \beta_3$) are normal with mean 0 and standard deviation 2.5

-   $\sigma$: the residual standard deviation, modeled as an exponential distribution with rate 1.

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`. More explanation of the model could be found [Appendix @sec-model-details].

## Model justification {#sec-modjust}

The linear regression model with Gaussian likelihood was chosen for this analysis due to its simplicity and effectiveness in modeling continuous outcome variables, such as life expectancy. Life expectancy is influenced by multiple factors, including region, income group, and gender. The linear model allows us to examine the average effect of each predictor on the outcome, assuming that the relationships between these predictors and life expectancy are linear.

The use of normal priors for the model coefficients $\alpha$ and $\beta$ reflects a belief in prior knowledge that the true values of these parameters are centered around zero, with some uncertainty, which is consistent with standard Bayesian modeling practices. The prior scale of 2.5 was chosen to reflect a reasonable level of uncertainty around the estimates without being overly restrictive.

The Gaussian distribution was selected because life expectancy data, by nature, is continuous and expected to follow a normal distribution. The assumption of normal residuals is consistent with the idea that deviations from the regression line are random and normally distributed, allowing the model to make accurate inferences about the relationship between predictors and the outcome.

Additionally, the exponential prior on the standard deviation $\alpha$ captures the residual variability in life expectancy across countries and regions. The exponential distribution was chosen because it provides a simple and interpretable way of modeling the variability, assuming that the data are not heavily skewed.

This approach is appropriate given the data structure and the goal of the analysis, which is to estimate and predict life expectancy across different countries, regions, income groups, and genders. The model's assumptions about the data, along with its priors, allow for robust inference in the context of population health predictions.

## Model Validation

To assess the performance of the life expectancy prediction model, two critical metrics were used: Root Mean Squared Error (RMSE) and Out-of-Sample Testing. These methods help ensure that the model generalizes well to unseen data and provides reliable predictions for life expectancy across different regions, income groups, and genders.

RMSE measures the square root of the average squared differences between the predicted and observed values. In the context of this model, RMSE quantifies how closely the predicted life expectancy values align with the actual observed values. Lower RMSE values indicate better model performance, suggesting that the model’s predictions are close to the true values. @tbl-modelpredict gives out the RMSE of both testing data and training data. The generalizability is checked by comparing rmse_test and rmse_train. Seeing the test RMSE is slightly lower than the training RMSE, the model generalizes well.

Out-of-Sample testing is a critical component of model evaluation. In this approach, the data is split into a training set and a test set (or holdout set). The training set is used to fit the model, while the test set is used to evaluate how well the model performs on new, unseen data. For this analysis, the model was trained using a portion of the data (80% of the dataset) and then evaluated on the remaining data (20% of the dataset) that was not used during training. This method allows us to check whether the model overfits the training data or if it can generalize well to unseen observations.

Together, RMSE and out-of-sample testing offer a robust framework for model validation, ensuring that the predictions made by the life expectancy model are both accurate and generalizable.

Extended versions of the table can be found in @tbl-testpredicted.

```{r}
#| label: tbl-modelpredict
#| tbl-cap: "Summary of the life expectancy model, which includes gender, region and income group. The table presents the model RSME and out-of sample testing. Seeing the testing data slightly less than the training data, our model is under good generalization."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Split the dataset into training and testing sets (80% train, 20% test)
set.seed(123)  # Setting seed for reproducibility
train_index <- createDataPartition(leab$`Life Expectancy`, p = 0.8, list = FALSE)

train_data <- leab[train_index, ]
test_data <- leab[-train_index, ]

# Predict life expectancy using the test data
predictions <- predict(model_developed, newdata = test_data)

# Calculate RMSE
actual_values <- test_data$`Life Expectancy`
rmse <- sqrt(mean((predictions - actual_values)^2))


# Calculate RMSE for the training set (in-sample testing)
train_predictions <- predict(model_developed, newdata = train_data)
train_rmse <- sqrt(mean((train_predictions - train_data$`Life Expectancy`)^2))

# Create the RMSE table
rmse_table <- data.frame(
  Dataset = c("Test Data", "Training Data"),
  RMSE = c(round(rmse, 2), round(train_rmse, 2))
)

# Create a styled table with kableExtra
rmse_table %>%
  kable(
    col.names = c("Dataset", "RMSE"), 
    align = "c", # Center alignment for columns
    digits = 2   # Display RMSE values with two decimal places
  ) %>%
  kable_styling(
    full_width = FALSE,
    font_size = 14
  ) 

```

# Results {#sec-result}

## Data results analysis

According to @fig-summary, we could tell that the mean life expectancy over the 6 years is 72.2, with a relatively low standard deviation of 7.8. This suggests that, on average, life expectancy across the dataset is fairly consistent, with only moderate variation from the mean. However, the maximum life expectancy of 87.4 stands out significantly, indicating that some countries or regions are achieving substantially higher life expectancy.With the mean at 72.2 and the median at 73.1, it’s apparent that the data is fairly symmetric, with the median being slightly higher than the mean, suggesting a mild left skew. This shift, combined with the large maximum value, hints at the presence of outliers—countries with exceptionally high life expectancy that pull the maximum up. The variance of 60.1 is relatively large, further supporting the idea that the data spans a wide range, with some observations considerably deviating from the central tendency.

Given this, the high variance can be attributed to the diversity in life expectancy values across different regions, particularly when countries at the higher end of the spectrum (e.g., those with life expectancy around 87 years) are compared with those at the lower end. This variability suggests that while most countries have life expectancy near 72 years, the outliers significantly influence the spread of the data, leading to a higher variance than what would be expected in a more homogenous dataset. Therefore, while the standard deviation is relatively small, the data is far from uniform, and a deeper analysis of the outliers could provide further insights into the factors contributing to the high life expectancy in certain regions.

@tbl-sum_sta summarizes global life expectancy across various categories such as gender, geographic regions, and income levels. We could tell that the global life expectancy is 72.13 years, providing a benchmark against which other categories can be compared. Women have a significantly higher life expectancy (74.62 years) than men (69.71 years), which reflects a common global trend due to biological and social factors. Region variation does happens to influence the life expectncy. Europe has the highest life expectancy (78.50 years), which is likely due to better healthcare and living conditions, with having the most amount of high income countries. Africa has the lowest (64.17 years), potentially reflecting challenges like limited healthcare infrastructure, poverty, and infectious diseases. Income level, as one of the most essential factor, significantly affect the life expectancy. High-income countries have the highest life expectancy (79.38 years), illustrating the correlation between economic wealth and longevity. High income level are believed to enable better living standard compared to other income groups. Upper middle income countries has an average of 73.38 years, where we could observe that the difference is significant lower than high income group. Lower middle income group has the life expectancy drop to 68.40. While these countries usually face challenges such as infrastructure and limit access to health resources, economic growth may need to be taken seriously be policy makers. Lower-income countries have a significantly lower life expectancy of 62.35 years, which can be attributed to limited access to healthcare, education, and basic services. @tbl-sum_sta highlights global inequalities and emphasizes the importance of improving living standards, especially in lower-income and underdeveloped regions.

## Overview of model results

Our results are summarized in @tbl-model. We are primarily interest in the general life expectancy regarding to the related predictors. The multiple linear model provides us with the estimates for the intercept and coefficients for the predictors which are male, female, both genders, lower income, lower-middle, upper-middle, high income, Asia, Europe, Africa, Oceania, North America and South America. The intercept represents the estimate of region-standard life expectancy when all the predictors are zero. The coefficients represent the additional life expectancy associated with each predictor. The model results will display the estimates- posterior means or medians for each coefficient including the intercept, uncertainty measures- credible intervals. The output values of each predictor is the regression coefficient, meaning how much the outcome is expected to increase or decrease with one unit increase in the life expectancy (per year) of that predictor, holding all else constant. The value in the brackets represent the Median Absolute Deviation of the posterior distributions of the coefficients. It conveys the dispersion around the median of each coefficients' posterior distribution, exhibiting how spread the distributions are.

Num.Obs represents the number of observations made in the model. R2 is the R-squared value which is the proportion of variance in the dependent variable that can be explained bu the independent variable. The R2 adj is the adjusted R squared which accounts for the number of predictors used. Log.lik is the log-likelihood which gives us an idea of the likelihood of the data, higher is the better, but this is typically used for comparison between the models. ELPD and ELPD s.e. explains the log predictive density and its standard error. The ELPD measures the sum of the log predictive densities for each observation, used for model comparison. LOOIC is an acronym for leave-one-out information criterion in which a lower value indicates a model with better out-of-sample predictive performance. WAIC stands for Watanabe-Akaike information criterion which is another measure of good fit; lower values are better fit. RMSE is the room mean squared error measuring the models's predictive performance where lower values means more accurate predicts.

```{r}
#| label: tbl-model
#| tbl-cap: Summary of the life expectancy model, which includes gender, region and income group. The table presents the model RSME and out-of sample testing.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Create a model summary with median absolute deviation (mad) for statistics
modelsummary(
  list("Gaussian(Normal)" = model_developed),
  statistic = "mad",  # Median absolute deviation
  fmt = 2,     # Format results to 2 decimal places
  output = "kableExtra"
) %>%
  kable_styling(font_size = 8.5,
                full_width = FALSE,  # Keeps the table from spanning the full width
    position = "center", # Centers the table
    bootstrap_options = c("striped", "condensed") # Makes rows tighter
  )

```

## Multiple linear regression results

@tbl-model is the table of the results from out model. The intercept serves as the baseline, which in this case is 79.53. Asia shows a negative coefficient of -6.22, indicating lower values compared to the baseline, with a relatively large standard error of 21.20. This suggests that as the predictor increases, the outcome tends to increase. In contrast, a negative coefficient implies a decrease in the outcome. Europe exhibits a negligible negative effect of -8.39, though it also has a large standard error of 45.65. The effect for females is more substantial, with a positive coefficient of 2.50 and a standard error of 0.05, indicating considerable variability in the estimate. The male and lower-middle-income groups show minimal negative coefficients, suggesting slight decreases from the baseline. The upper-middle-income group, however, shows a positive effect of 3.40 relative to the baseline. Regions like North America, Oceania, Asia, and Europe all have notable negative coefficients, highlighting significant regional variations. In general, there is a downward trend in coefficients across countries. Most countries exhibit large standard errors, with European countries such as Ireland, Israel, and Italy showing slightly positive trends.

With an R-squared value of 0.976, the model demonstrates a strong level of explanatory power, supporting the accuracy of the results. The adjusted R-squared value is 0.975, which is nearly identical to the R-squared value, indicating the model's robustness with 3,312 observations. The RMSE of 4.37 reflects the average magnitude of the model's prediction errors, suggesting good predictive accuracy. Although values like LOOIC and WAIC are excluded due to the lack of alternative models for comparison, the overall results indicate that the model performs well on the cleaned dataset.Further evaluation of the model results will be done in @sec-model-details.

# Discussion {#sec-discussion}

## Insights into Life Expectancy Differences by Gender

Thought the result part we have noticed that female constantly have higher life expectancy than male. @fig-gender shows that female has around 4 years higher average age than male. Even during the sudden drop of 2020, female kept a more stable trend than male. Through literature research, we found that historically women tend to have longer life than men across most regions and cultures. [@whymandieyounger]These difference can be attributed to a variety of interconnected reasons. Women generally have stronger immune systems and are less prone to certain life-threatening diseases like cardiovascular diseases in early adulthood. Estrogen, a hormone prevalent in women, provides some protection against heart disease by improving cholesterol levels. On the other hand, men are more prone to risk factors such as hypertension and higher levels of LDL cholesterol, which contribute to shorter life spansehavioral patterns [@behaviouralfactor]. What's more, male are more likely to engage in behaviours such as smoking, excessive alcohol consumption and hazardous occupations. These behaviors increase the risk of accidents, chronic diseases, and early mortality. Last but not least, globally, women tend to use healthcare services more frequently than men, which allows for earlier detection and treatment of illnesses. Men often delay seeking medical care, worsening outcomes for preventable or manageable diseases.[@womenhigherhealthcare]

## Insights into Life Expectancy Differences by Income Group

From the summary and analysis of @tbl-sum_sta, we have seen that high income group has the significant high life expectancy compared to the lower income group, which indicates that life expectancy is significantly influenced by income groups. It is known that income determines access to resources, healthcare and living conditions. Difference in life expectancy across income groups reflect broader inequalities in socioeconomic factors and highlight disparities in global health outcomes.

High-income groups have greater access to quality healthcare services, including preventive care, advanced medical treatments, and regular health checkups.Conversely, lower-income groups often face barriers such as cost, lack of infrastructure, and insufficient health insurance coverage, leading to untreated or poorly managed health conditions [@inequalworld]. Other living conditions like access to nutritious food, safe drinking water and sanitary living environments are also linked with high economics. Low-income populations are more likely to experience malnutrition, exposure to environmental toxins, and overcrowded living conditions, all of which negatively impact health and life expectancy.

What's more, lower-income individuals are often exposed to higher levels of chronic stress due to financial instability and job insecurity. Stress is linked to adverse health outcomes such as hypertension, cardiovascular diseases, and mental health issues [@incomeinequality]. Moreover, low-income workers frequently engage in physically demanding or hazardous jobs, increasing their risk of injury and illness. All these factors together makes the lower income countries disadvantage in life expectancy.

## Life Expectancy at 60

The life expectancy at 60 means that how long is a person expected to live at 60 instead of at birth. From the box plot @fig-lea60, we could tell the high-income group tends to have an average life expectancy of approximately 23 years at age 60, whereas the lower-income group averages around 16 years. Notably, the lower-middle-income group exhibits the largest variance, with the most outliers, indicating a wide disparity in life expectancy within this category.

The data also reveal a clear trend: as income levels increase, so does the average life expectancy at age 60. This aligns with findings from analyses of life expectancy at birth, emphasizing the significant correlation between income and life expectancy. Higher-income groups likely benefit from better access to healthcare, nutrition, and living conditions, which collectively contribute to improved longevity.

Life expectancy at 60 provides insights into the additional years a person can expect to live after reaching 60, reflecting the health and living conditions of older populations. Unlike life expectancy at birth, which captures the average years a newborn is expected to live based on current mortality rates across all ages, life expectancy at 60 excludes the impact of child and early-adult mortality. This makes it particularly useful for assessing health outcomes, chronic disease management, and the effectiveness of healthcare systems for aging populations. It highlights longevity and quality of life in later years, crucial for designing age-focused policies and support systems.

```{r}
#| label: fig-lea60
#| fig-cap: "Box plot of life expectancy at 60 by different income group. The high income group tend to have 23 years of life expectancy at 60 while the lower income group has an average of 16 years at 60. It is noticable that lower middle has the most outlier showing the largest varaiance."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Create a boxplot to show life expectancy by income group
ggplot(lea60, aes(x = Income_Group, y = `Life Expectancy`, fill = Income_Group)) +
  geom_boxplot(outlier.color = "red", outlier.shape = 16, outlier.size = 2) +
  labs(
    title = "Life Expectancy by Income Group",
    x = "Income Group",
    y = "Life Expectancy"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  ) +
  scale_fill_brewer(palette = "Set3")

```

## Weaknesses and next steps

### Other factors related to income group and region

Income groups, often categorized as low, middle, or high-income, play a significant role in determining access to resources and opportunities that directly and indirectly affect life expectancy. However, income group classifications themselves are shaped by a variety of factors that this analysis may not have accounted for, which introduces limitations to the model. Region would be one key factor that influence the income group. Regions with limited access to stable employment opportunities may fall into lower-income groups, leading to reduced access to healthcare, education, and nutritious food, all of which affect life expectancy. It is reckon that trade imbalances, resource exploitation, and historical colonization have left some countries with weak economies and infrastructure, directly influencing their classification as low or middle-income. Since these factors influence the income groups, their absence in the model creates a gap in understanding how income ultimately impacts life expectancy. A comprehensive model should explore these underlying determinants of income groups alongside traditional predictors of life expectancy.

### Dataset limitation

Weakness may arise from the generalization of the data. When working with data provided by authoritative sources like the World Health Organization (WHO), it’s important to recognize the methodological nuances underlying the calculations. In this case, the dataset includes average life expectancy values, which are themselves estimates derived from sophisticated statistical and demographic models. The accuracy of the derived averages depends heavily on the statistical methods used by WHO. Since the initial dataset offers the average of the life expectancy of each country which are calculated after several factor, these assumptions cascade into our analysis. The "average of averages" cannot rectify inaccuracies or gaps in the original model.

By acknowledging these limitations and incorporating appropriate statistical techniques, for further studies, it would be suggested to use a more variety of models such as the multilevel modeling to increase the accuracy of the model by cross validation or comparing the results from other models as well. Study deeper into the correlations with more factors we discussed above would let us notice which factors influences life expectancy. Like mentioned in the introduction, this analysis aims to empower policymakers by providing critical insights into factors affecting life expectancy across various regions, genders, and income groups. By addressing identified limitations and leveraging data-driven strategies, analyses can better capture the complexities of life expectancy data and provide insights that align more closely with real-world dynamics while policymakers can implement targeted interventions to improve healthcare access, reduce disparities, and enhance the overall quality of life for their populations.

\newpage

\appendix

# Appendix {#sec-appx}

## Data Cleaning Notes

We began by importing the raw dataset using the read_csv function from the tidyverse package. To focus our analysis on more relevant variables, we selected specific columns, such as Indicator of life expectancy as birth and life expectancy at 60 years, Country, Period, Gender, and Life expectancy, omitting any unnecessary columns.

We functioned to extract the number before opening the square bracket of life expectancy since the raw data gave both the range and the mean of life expectancy of each country under each year.

We filter out the rows containing NA values in any of the selected columns for reducing the noise and simpler further analysis.

We then renaming columns for clarity. For example, we changed ‘Location’ into ‘Country’, "Dim1" for "Gender" and "Value" for "Life Expectancy", making it easier for anyone working with the data to read and understand what each variable represents.

Each column is rounded using the round function, specifying the desired number of decimal places for each. Columns not mentioned in mutate remain unchanged. This ensures a flexible and precise cleaning process tailored to further comparison and graphing. We dropped the potential percentage symbol to contain purely numerical data.

The income group column and the region column was not given in the raw dataset. We created a new variable called "Income_Group" by mapping over country name to four income group (lower_income, lower_middle, upper_middle, high_income) according to the index given by World Bank Income Group. This is a key variable in predicting life expectancy since it is believed that life expectancy is correlated to the income situation. We as well made a mapping to the countries according to its continent and saved as "Region". This is the variable indicates the geographic context to the analysis. Countries are mapped into six continents ("Africa", "Asia", "Europe", "North America", "South America", "Oceania") one by one.

We again merge the table, removing repeated columns and rows and mapping the region and the country income under different given names.

Lastly, we filter out NAs again as a further check. We continue filter out the Palestinian territory, which is not a country and was not mapped in neither Region nor Income Group.

For easy reading format, we arrange the country into Alphabet order and mutate the variables again for converting columns into appropriate data types.

For easier visualization, we created four tables, which are grouped by life expectancy at age 60, life expectancy at birth, life expectancy at birth of Male and life expectancy at birth of Female.

After completing the cleaning, we saved the final dataset in both Parquet and CSV formats for later analysis.

## Data Cleaning Table

```{r}
#| label: tbl-cleaned_average
#| tbl-cap: "Cleaned data of average life expectancy of 6 years by different countries. Full cleaned Average life expectancy by country by gender could be find in https://github.com/wendyhuan/lifeexpectancy/blob/main/data/02-analysis_data/average_life_expectancy.csv"
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Create a nicely formatted kable table
bothg_average_life_expectancy %>%
  kable(
    col.names = c("Country", "Income Group", "Region", "Average Life Expectancy"),
    align = c("l", "l", "l", "l", "r"),
    digits = 2,
    output = "kableExtra"
) %>%
  kable_styling(font_size = 8.5,
    full_width = FALSE,
    position = "center",
    bootstrap_options = c("striped", "condensed")
  ) 
```

## Idealized Survey

**Survey: Life Expectancy and Lifestyle Survey**

Thank you for participating in this survey. This survey aims to gather insights into the factors influencing life expectancy, including gender, region and income group. Your responses will help us understand individual perspectives and experience towards national policy. Participation is voluntary, and your answers will remain anonymous.

**Contact Information:** If you have any questions about the survey or the data collection process, please contact

**Survey Coordinator**: Yanfei Huang\
**Email**: yanfei.huang\@mail.utoronto.ca

**Section 1: Demographics**

**1. Gender**

-   Male
-   Female
-   Non-binary
-   Prefer not to say

**2. Age (in years)**

Please write the number: \_\_\_\_\_\_

**3. Region of Residence**

-   Africa
-   Asia
-   Europe
-   North America
-   South America
-   Oceania

**4. Income Level**

Annual Income (Optional): \_\_\_\_\_\_ USD

Income Group: - Low Income (Less than \$1,000/year) - Lower-Middle Income (\$1,001 - \$10,000/year) - Upper-Middle Income (\$10,001 - \$50,000/year) - High Income (More than \$50,000/year)

**Section 2: Health and Lifestyle**

**5. Current Life Expectancy Perception**

How many years do you expect to live?

Please write the number: \_\_\_\_\_\_

**6. Healthcare Access**

How often do you visit healthcare professionals - Regularly (e.g., annual checkups) - Occasionally (e.g., only when unwell) - Rarely or Never

**7. Dietary Habits**

How would you describe your diet?

-   Balanced and healthy
-   Somewhat balanced
-   Unhealthy

**8. Physical Activity**

How many hours of physical activity do you engage in per week? - Less than 1 hour - 1-3 hours - More than 3 hours

**9. Smoking Habits**

Do you smoke?

-   Yes
-   No

**10. Alcohol Consumption**

How often do you consume alcoholic beverages?

-   Never
-   Occasionally (e.g., social drinking)
-   Frequently

**Section 3: Environmental and Social Factors**

**11.Living Environment**

How would you describe your living area?

-   Urban
-   Suburban
-   Rural

**Final Section**

Thank you for completing this survey! Your responses will help capture information about economic conditions, access to healthcare and education, and basic living standards, which are critical for understanding life expectancy predictors and the impact of socioeconomic factors on health outcomes.

# Additional data details

## Model details {#sec-model-details}

The model developed for predicting life expectancy is a linear regression model, where the goal is to estimate the outcome variable, Life Expectancy, based on multiple predictors: Region, Income Group, and Gender. Here's a more detailed breakdown of the components and structure of the model:

**1. Outcome variable (**$y_i$)

The outcome variable $y_i$ represents the life expectancy of an country. This is a continuous variable representing the number of years a person is expected to live, assuming all conditions remain constant.

**2. Linear Predictor (**$μ_i$)

The linear predictor $μ_i$ is a linear combination of the predictors, which includes an intercept term $α$ and the coefficients $β_1$, $β_2$, $β_3$, corresponding to Region, Income Group, and Gender, respectively. This linear equation models the relationship between life expectancy and the predictors $\mu_i = \alpha + \beta_1(Region) + \beta_2(Income Group) + \beta_3 (Gender)$. The values for these coefficients (betas) represent the expected change in life expectancy for a one-unit change in each respective predictor.

**3. Priors**

The prior distribution for the intercept $α$ and the coefficients $β_1$, $β_2$, $β_3$ is assumed to be normal with a mean of 0 and a standard deviation of 2.5. This reflects our belief that, prior to seeing the data, the intercept and coefficients are most likely close to 0, with a reasonable range of variability (the scale of 2.5 is relatively broad, allowing flexibility in fitting the model).

The prior for $σ$ (residual standard deviation) is assumed to follow an exponential distribution with a rate of 1. This prior reflects the assumption that the variance of the residuals (i.e., the deviation of the actual observations from the predicted values) is positive and that it could reasonably be spread across a wide range of values.

**4. Residual Standard Deviation (**$σ$) The model also estimates $σ$, which represents the standard deviation of the residuals — the errors between the observed life expectancy values and those predicted by the model. The prior for $σ$ is assumed to follow an exponential distribution with a rate of 1, meaning that smaller values of $σ$ (indicating less variation) are somewhat more likely than larger ones.

**5. Gaussian Likelihood** The outcome variable Life Expectancy is modeled using a normal distribution with mean μi (the linear predictor) and standard deviation σ. This means that the residuals (the differences between the observed and predicted values) are assumed to be normally distributed: $y_i| \mu_i, \sigma ~ Normal(\mu_i, \sigma)$ This is a typical assumption in regression models when the data is continuous, and the relationship between the predictors and the outcome is linear.

## RMSE Full table

```{r}
#| label: tbl-testpredicted
#| tbl-cap: "Partical table of the test and training RMSE of Life expectancy over countries and gender of average of 6 years (First 100 rows). Through the model part we could tell that with comparing the training and testing data, the model is well generated without doubt."
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Create a data frame for the predicted values and actual values in the test set
results_df <- data.frame(
  Country = test_data$Country,
  Actual_Life_Expectancy = actual_values,
  Predicted_Life_Expectancy = predictions,
  RMSE_Test = rmse,
  RMSE_Train = train_rmse
)

# Create an indication column based on the RMSE comparison
results_df$Indication <- ifelse(results_df$RMSE_Test < results_df$RMSE_Train, 
                                 "Model generalizes well (out-of-sample)", 
                                 "Model may be overfitting the training data")

# Format the table using kable
results_df %>%
  head(100) %>%
  kable(col.names = c("Country", "Actual Life Expectancy", "Predicted Life Expectancy", "RMSE (Test)", "RMSE (Train)", "Indication"),
  align = c("l", "r", "r", "r", "r", "l"),
  digits = 2,
  output = "kableExtra"
) |>
  kable_styling(font_size = 7.5,
                full_width = FALSE,  # Keeps the table from spanning the full width
    position = "center", # Centers the table
    bootstrap_options = c("striped", "condensed"))

```

\newpage

# References
