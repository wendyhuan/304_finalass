---
title: "Global Life Expectancy: Unraveling Health and Economic Determinants (2000-2015)"
subtitle: "Analyzing Critical Factors Shaping Mortality and Well-Being Across 193 Nations"
author: 
  - Yanfei Huang
thanks: "Code and data are available at: [https://github.com/wendyhuan/lifeexpectancy](https://github.com/wendyhuan/lifeexpectancy)."
date: 26 November 2024
date-format: long
abstract: "This paper analyze life expectancy and its determinants through 193 countries and make the prediction of people from both developed and developing country. Multiple Linear regression is used to deploying the health and socio-economic factors. Predictions of life expectancy of people from developed or developing country is made according to the essential predictors. The finding indicates that the developed countries tend to live longer life as assumed. And we predict that the average age of persons in developed country is 80, while those in underdeveloped countries are 75. The result of this paper will help in suggesting a country which area should be given importance in order to efficiently improve the life expectancy of its population."
format: pdf
toc: true
toc-depth: 3
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

# Install Packages if not downloaded:
required_packages <- c(
  "tidyverse", "sf", "dplyr", "here", "arrow", "ggplot2", "janitor", "purrr", "knitr", "kableExtra", "ggcorrplot", "modelsummary"
)
for (p in required_packages) {
  if (!require(p, character.only = TRUE)) {
    install.packages(p, character.only = TRUE)
  }
}

#load libraries
library(tidyverse)
library(sf)
library(dplyr)
library(here)
library(arrow)
library(ggplot2)
library(janitor)
library(purrr)
library(knitr)
library(kableExtra)
library(ggcorrplot)
library(modelsummary)
library(countrycode)

# load data
cleaned_expectancy <- read_parquet(here::here("data/02-analysis_data/analysis_data.parquet"))

```


# Introduction
Life expectancy is a critical measure of a population's overall health and well-being, shaped by various factors such as personal expenditure on health, government healthcare access, economic stability, and social structures. The index of life expectancy is generally served as a benchmark for development, indicating the effectiveness of interventions in reducing mortality and improving well-being. Higher life expectancy is believed to linked to better living standards, access to education, and equitable healthcare. Conversely, low life expectancy often signals systemic challenges such as poverty, disease burden, and inadequate healthcare access [@socialdeterminantsofhealth]. 

The primary goal of this paper is to determine which factors play a statistically significant role in driving lower life expectancy values and to offer actionable insights based on country status. Using Multiple Linear Regression model, this study focuses on understanding the relationship between country status(developed or developing), continent, personal average expenditure on health based on GDP, percentage of government expenditure on health, income composition of resources and year of schooling in predicting life expectancy across different countries. By identifying and analyzing these predictors, the study aims to highlight actionable aspects for policymakers to target in their efforts to improve population longevity effectively.

Related Research has shown that higher healthcare expenditure of government positively impact life expectancy [@valueofvaccination]. Additionally, addressing social determinants such as education and income inequality has been identified as a vital pathway to improving longevity [@healthequity]. Studies also highlight the role of global collaboration in tackling health crises, which can disproportionately affect lower-income nations, mostly developing countries under certain continents, further influencing life expectancy disparities [@World_Health_Organization].

Findings from this paper reveal that countries with greater healthcare spending tend to achieve higher life expectancy, while factors like income inequality and absence of education emerge as significant obstacles. The analysis underscores the importance of targeted interventions in key areas such as healthcare accessibility and economic equity to address disparities in life expectancy. This study further contributes to a deeper understanding of how predictive modeling under different country status can inform public health strategies and policy-making on a global scale.

The ultimate goal is to assist policymakers in developing evidence-based strategies that can enhance population health outcomes. The approach of this paper not only emphasizes the importance of equitable access to healthcare but also contributes to a broader understanding of the multifaceted factors shaping life expectancy globally. By highlighting the interplay between various determinants, this study contributes to a broader understanding of the challenges and opportunities in improving life expectancy on a global scale. 

The structure of the paper is as follows: [@sec-data] outlines the data sources and variables considered, followed by the model setup in [@sec-modset] and justification in [@sec-modjust]. The results in [@sec-result] presents the key findings of the analysis, with a discussion on the implications. [@sec-discussion] then discusses potential limitations and suggestions for future research. [@sec-appx] provides additional detailed information about the data, model and methodology.


# Data {#sec-data}

## Overview

The data used in this analysis originates from The World Health Organizationâ€™s (WHO) and Global Health Observatory (GHO), as compiled and merged by Kumar Rajarshi on Kaggle. [@lifeexpectancykaggle]. The analysis uses the statistical programming language R [@citeR] and several libraries, including `tidyverse` [@tidyverse], `janitor` [@janitor], `knitr` [@knitr], `dplyr` [@dplyr], `arrow` [@arrow], `purrr` [@purrr], `sf` [@sf], and `here` [@here] for data manipulation. `ggplot2` [@ggplot], `ggcorrplot` [@ggcorrplot] and `kableExtra` [@kableExtra] for visualization. The dataset covers various predictors conducted across multiple countries, capturing the support for a country to determine the predicting factor which is contributing to lower value of life expectancy.

## Measurement
	
Some paragraphs about how we go from a phenomena in the world to an entry in the dataset.



## Data Cleaning




## Outcome Variables

The main outcome variable of interest is the Expectancy of Life, which represents the predicted age of people from either developed country or developing country. This variable is needed 



Percentage of support each candidate has in a given poll, which represents the proportion of respondents who favor one candidate over the other. This variable is needed to estimate both the popular vote and Electoral College outcomes. We see a bimodal distribution in @fig-percentage. This indicates that candidates are either recieveing very high percentages of support or very low percentages of support. When we pull out Harris and Trump and view their distributions versus all candidates in @fig-candidatepercentage, we see that these two candidates see statistically high percentages of support, indicating they are leading the polls.

```{r}
#| label: fig-percentage
#| fig-cap: This histogram shows the distribution of the percentage of support each candidate receives in various polls. The bimodal nature of the distribution suggests that candidates either receive very high or low support, with few receiving moderate levels of backing.
#| echo: false
#| eval: true
#| warning: false
#| message: false


# create plot for Distribution of Percentage
ggplot(cleaned_expectancy, aes(x = Percentage)) +
  geom_histogram(
    bins = 30,
    fill = "orange",
    color = "black",
    alpha = 0.7
  ) +
  labs(
    x = "Percentage",
    y = "Frequency"
  ) +
  theme_minimal()
```

```{r}
#| label: fig-candidatepercentage
#| fig-cap:  Violin plot comparing the distribution of support between Donald Trump, Kamala Harris, and all other candidates. The two candidates exhibit higher-than-average support levels, with Harris and Trump leading the polls in terms of percentage of backing.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# filter for trump/harris
harris_trump_selection <- cleaned_data %>%
  filter(CandidateName %in% c(
    "Donald Trump",
    "Kamala Harris"
  ))

all_candidates <- cleaned_data %>%
  mutate(CandidateName = "All Candidates")

# create data frame with trump vs harris vs all candidates
combined_data <- bind_rows(
  harris_trump_selection,
  all_candidates
)

# create plot for Distribution of Percentage by candidate
ggplot(combined_data, aes(
  x = CandidateName,
  y = Percentage,
  fill = CandidateName
)) +
  geom_violin(alpha = 0.5) +
  geom_boxplot(width = 0.1, color = "black", outlier.shape = NA) +
  labs(
    x = "Candidate",
    y = "Percentage"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_manual(values = c("grey", "salmon", "blue")) +
  facet_wrap(~CandidateName, scales = "free_x") +
  theme_minimal()
```



## Predictor Variables
























Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-bills
#| fig-cap: Bills of penguins
#| echo: false

ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = "none") +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(aes(x = width, y = length)) +
  geom_point(alpha = 0.8) +
  theme_minimal() +
  labs(x = "Wing width (mm)",
       y = "Wing length (mm)")
```

Talk way more about it. 

## Predictor variables

Add graphs, tables and text.

Use sub-sub-headings for each outcome variable and feel free to combine a few into one if they go together naturally.








# Model
To predict the outcome of the life expectancy of people from different regions, we developed tow linear regression models: one for the developed country and one for developing country. These models aim to estimate the life expectancy of people under different environment. 

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up {#sec-modset}

This paper utilizes linear regression models: 
$$LifeExpecetancy_I = \beta_0 + \beta_1 $$
$$LifeExpectancy_D = \beta_0 + \beta_1$$




Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


